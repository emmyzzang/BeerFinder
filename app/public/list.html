<!DOCTYPE html>
<html>

<head>
  <title>Beer Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/style.css">

  <style>
  body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", Arial, Helvetica, sans-serif}
  .myLink {display: none}
  </style>
</head>

<body class="w3-light-grey">
  <!-- NAVBAR START -->
  <div class="w3-top">
    <div class="w3-row w3-padding w3-black">
      <div class="w3-col s2">
        <a href="dashboard" class="w3-button w3-block w3-black">
          <i class="fa fa-beer fa-lg" aria-hidden="true"></i>
          &nbsp; DASHBOARD
        </a>
      </div>
      <div class="w3-col s2">
        <a href="catalogue" class="w3-button w3-block w3-black">
          <i class="fa fa-search fa-lg" aria-hidden="true"></i>
          &nbsp; CATALOGUE
        </a>
      </div>
      <div class="w3-col s2">
        <a href="randomize" class="w3-button w3-block w3-black">
          <i class="fa fa-question fa-lg" aria-hidden="true"></i>
          &nbsp; FEELING LUCKY
        </a>
      </div>
      <div class="w3-col s2">
        <a href="reviews" class="w3-button w3-block w3-black">
          <i class="fa fa-star fa-lg" aria-hidden="true"></i>
          &nbsp; REVIEWS
        </a>
      </div>
      <div class="w3-col s2">
        <a href="list" class="w3-button w3-block w3-black">
          <i class="fa fa-list fa-lg" aria-hidden="true"></i>
          &nbsp; YOUR LIST
        </a>
      </div>
      <div class="w3-col s2">
        <a href="logout" class="w3-button w3-block w3-black">
          <i class="fa fa-sign-out fa-lg" aria-hidden="true"></i>
          &nbsp; SIGN-OUT
        </a>
      </div>
    </div>
  </div>
  <!-- NAVBAR END -->
  <header class="w3-display-container w3-content w3-hide-small" style="max-width:1500px">
  </header>
  <div class="w3-display-middle" style=" margin-top: 20em;">
    <div class="w3-container">


      <div class="w3-container">

        <div class="w3-panel w3-padding-16 w3-black w3-opacity w3-card-2 w3-hover-opacity-off">
          <div class="w3-container">
            <p class="w3-large"><b>Past Beers!</b></p>
          </div>
          <div class="container"></div>
          <div class="panel-body">
            <table class="table table-hover" style="width:100%" id='beers-table'>
              <thead>
                <tr>
                  <th>Beer Names</th>
                  <th>Type</th>
                  <th>Clarity</th>
                  <th>Hue</th>
                  <th>Bitterness Units</th>
                  <th>Bubble Size</th>
                  <th>Head</th>
                  <th>Your Rating</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
        <br>
      </div>
    </div>
  </div>

  <br>
  <br>

</div>
</body>
</html>

<script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous"></script>

<script>
$(document).ready(function() {
  // Not dependent on a click, because user list loads on pageload
  // Do not need to worry about dynamic loading because as a user, solely populating list
  function getBeers() {
    $.get('/myList',
    // Do not need a second parameter because the second param would have been used for a post
    // And we are only retreiving info from this /myList route (which is where the logic that does db call sits)
    function(res){
      console.log(res);
      // Iterate thru result of the .get call /myList -- the object from the db
      // Populate the UI
      $('#beers-table').html(
            '<tr><td class="beerName">' + res[0].beers[0].name + '</td>' +
            '<td>' + res[0].beers[0].type + '</td>' +
            '<td>' + res[0].beers[0].clarity + '</td>' +
            '<td>' + res[0].beers[0].hue + '</td>' +
            '<td>' + res[0].beers[0].ibu + '</td>' +
            '<td>' + res[0].beers[0].bubbleSize + '</td>' +
            '<td>' + res[0].beers[0].head + '</td>' +
            '<td>' + res[0].user_rating + '</td>' +
            '<td><i data-beer-id="' + res[0].id + '" class="fa fa-times-circle" aria-hidden="true"></i></td>' + 
            '</tr>');

      for (var i = 1; i < res.length; i++) {
          if(res[i].beers.length != 0){
            $('#beers-table').append(
            '<tr><td class="beerName">' + res[i].beers[0].name + '</td>' +
            '<td>' + res[i].beers[0].type + '</td>' +
            '<td>' + res[i].beers[0].clarity + '</td>' +
            '<td>' + res[i].beers[0].hue + '</td>' +
            '<td>' + res[i].beers[0].ibu + '</td>' +
            '<td>' + res[i].beers[0].bubbleSize + '</td>' +
            '<td>' + res[i].beers[0].head + '</td>' +
            '<td>' + res[i].user_rating + '</td>' +
            '<td><i data-beer-id="' + res[i].id + '" class="fa fa-times-circle" aria-hidden="true"></i></td>' + 
            '</tr>');
          }
        }


      $('tr i').click(function(event) {
          var beerId = $(event.target).data('beer-id');
          deletePost(beerId);
      })
    });
  };

  function deletePost(id) {
    $.ajax({
      method: "DELETE",
      url: "/posts/" + id
    })
    .done(function() {
      getBeers();
    });
  } 

  getBeers();

});
  </script>
